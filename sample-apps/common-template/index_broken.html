<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ çµ±åˆã‚¢ãƒ—ãƒªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v1.0</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --warning: #FF9800;
            --danger: #f44336;
            --success: #4CAF50;
            --bg: #f8f9fa;
            --surface: #fff;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        h1 {
            color: var(--primary);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .version-badge {
            background: var(--secondary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: normal;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .auth-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .auth-btn:hover {
            opacity: 0.9;
        }

        /* ã‚¢ãƒ—ãƒªã‚¿ãƒ– */
        .app-tabs {
            display: flex;
            background: var(--surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .app-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-light);
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .app-tab:hover {
            background: var(--bg);
            color: var(--text);
        }

        .app-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--bg);
        }

        .app-tab .icon {
            font-size: 1.2rem;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            background: var(--surface);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            min-height: 500px;
        }

        .app-content {
            display: none;
            padding: 20px;
        }

        .app-content.active {
            display: block;
        }

        .welcome-content {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .welcome-content p {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± */
        .system-info {
            background: var(--bg);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-card {
            background: var(--surface);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }

        .info-card h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .info-card p {
            color: var(--text);
            font-weight: 500;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: opacity 0.3s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-danger {
            background: var(--danger);
        }

        /* ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .log-section {
            margin-top: 20px;
        }

        .log-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .debug-logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-line;
        }

        /* è¨­å®šãƒ‘ãƒãƒ« */
        .settings-panel {
            background: var(--bg);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        /* ãŠé‡‘ç®¡ç†ç”»é¢ */
        .money-panel {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .input-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .form-control {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            flex: 1;
            min-width: 120px;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }

        .transaction-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }

        .transactions-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-income {
            border-left: 4px solid var(--success);
        }

        .transaction-expense {
            border-left: 4px solid var(--danger);
        }

        /* æ™‚é–“ç®¡ç†ãƒ»ä½“é‡ç®¡ç†ç”»é¢ */
        .time-panel, .weight-panel {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timer-section, .bmi-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }

        .timer-display, .bmi-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin: 10px 0;
        }

        .timer-clock {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            margin: 15px 0;
        }

        .timer-task {
            font-size: 1.1rem;
            color: #666;
            margin-top: 10px;
        }

        .bmi-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .bmi-status {
            font-size: 1.2rem;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .bmi-underweight { background: #e3f2fd; color: #1976d2; }
        .bmi-normal { background: #e8f5e8; color: #388e3c; }
        .bmi-overweight { background: #fff3e0; color: #f57c00; }
        .bmi-obese { background: #ffebee; color: #d32f2f; }

        .time-list, .weight-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }

        .records-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-work { border-left: 4px solid #2196F3; }
        .record-study { border-left: 4px solid #4CAF50; }
        .record-exercise { border-left: 4px solid #FF9800; }
        .record-break { border-left: 4px solid #9C27B0; }
        .record-other { border-left: 4px solid #607D8B; }

        /* ãƒ¡ãƒ¢ç®¡ç†ç”»é¢ */
        .memo-panel {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .memo-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }

        .memo-display {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        .memo-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .memo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .memo-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .memo-category {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .memo-content {
            margin: 10px 0;
            line-height: 1.5;
            color: #555;
            white-space: pre-wrap;
        }

        .memo-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        .memo-tags {
            display: flex;
            gap: 5px;
        }

        .memo-tag {
            background: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .memo-delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .memo-delete-btn:hover {
            opacity: 0.8;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ */
        .memo-filter-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .filter-input-section {
            margin-bottom: 15px;
        }

        .filter-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .filter-keyword-tag {
            display: inline-flex;
            align-items: center;
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            gap: 8px;
            animation: fadeIn 0.3s ease-in;
        }

        .filter-keyword-tag .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .filter-keyword-tag .remove-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .filter-empty-state {
            color: #999;
            font-style: italic;
            padding: 10px;
            text-align: center;
        }

        /* è¨ˆç®—æ©Ÿã‚¹ã‚¿ã‚¤ãƒ« */
        .calc-form {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .calc-input-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .calc-input {
            width: 120px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .calc-operator, .calc-equals {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            min-width: 30px;
            text-align: center;
        }

        .calc-result {
            font-size: 24px;
            font-weight: bold;
            color: var(--success);
            min-width: 100px;
            background: var(--bg);
            padding: 8px 15px;
            border-radius: 6px;
            border: 2px solid var(--success);
            text-align: center;
        }

        .calc-button-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .calc-btn {
            background: var(--primary);
            font-size: 16px;
            font-weight: bold;
            min-width: 120px;
        }

        .calc-history-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--surface);
        }

        .calc-history-item {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calc-history-item:last-child {
            border-bottom: none;
        }

        .calc-history-item:hover {
            background: var(--bg);
        }

        .calc-expression {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
        }

        .calc-timestamp {
            color: var(--text-light);
            font-size: 12px;
        }

        .calc-delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .calc-delete-btn:hover {
            opacity: 0.8;
        }

        .config-editor {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            width: 100%;
            min-height: 200px;
            resize: vertical;
        }

        /* è¨­å®šç®¡ç†UI */
        .config-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .checkbox-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--bg);
            transition: background-color 0.2s;
        }

        .checkbox-item:hover {
            background: #f0f0f0;
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
            transform: scale(1.1);
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            flex: 1;
            font-weight: normal;
        }

        .checkbox-item.enabled {
            background: #e8f5e8;
            border-color: var(--success);
        }

        .app-icon {
            font-size: 16px;
            margin-right: 4px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .app-tabs {
                flex-direction: column;
            }
            
            .app-tab {
                justify-content: center;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .status-success {
            background: #e8f5e8;
            color: #2e7d2e;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        /* ãƒ­ã‚°é–²è¦§ç”»é¢ */
        .logs-panel {
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .log-selection, .log-search, .log-content {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg);
            border-radius: 6px;
        }

        .log-controls, .search-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .log-display {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            padding: 15px;
            border-radius: 4px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #333;
        }

        .log-line {
            padding: 2px 0;
            border-bottom: 1px solid #333;
        }

        .log-line:last-child {
            border-bottom: none;
        }

        .log-line.highlight {
            background: #264f78;
            color: #ffffff;
        }

        .log-header {
            background: #2d4a5a !important;
            color: #87ceeb !important;
            font-weight: bold;
            border: none !important;
        }

        .file-name {
            color: #87ceeb;
            font-size: 0.9rem;
            font-weight: normal;
            opacity: 0.8;
        }

        .search-count {
            color: var(--primary);
            font-weight: bold;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header>
            <h1>
                ğŸš€ çµ±åˆã‚¢ãƒ—ãƒªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
                <span class="version-badge">v0.3</span>
            </h1>
            <div class="user-info" id="userInfo">
                <div class="status" id="connectionStatus">
                    <span class="loading"></span>
                    <span>æ¥ç¶šä¸­...</span>
                </div>
                <button class="auth-btn" id="authBtn">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
        </header>

        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± -->
        <div class="system-info">
            <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h3>
            <div class="info-grid" id="systemInfo">
                <div class="info-card">
                    <h4>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</h4>
                    <p id="version">0.3</p>
                </div>
                <div class="info-card">
                    <h4>æœ‰åŠ¹ã‚¢ãƒ—ãƒªæ•°</h4>
                    <p id="enabledApps">èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- ã‚¢ãƒ—ãƒªã‚¿ãƒ– -->
        <div class="app-tabs" id="appTabs">
            <button class="app-tab active" data-app="simple">
                <span class="icon">ğŸ“„</span>
                <span>ã‚·ãƒ³ãƒ—ãƒ«</span>
            </button>
            <button class="app-tab" data-app="settings">
                <span class="icon">âš™ï¸</span>
                <span>è¨­å®š</span>
            </button>
            <button class="app-tab" data-app="logs">
                <span class="icon">ğŸ“‹</span>
                <span>ãƒ­ã‚°</span>
            </button>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªç”»é¢ -->
            <div class="app-content active" id="simple-content">
                <!-- å‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ -->
            </div>

            <!-- è¨­å®šç”»é¢ -->
            <div class="app-content" id="settings-content">
                <div class="settings-panel">
                    <h3>âš™ï¸ è¨­å®šç®¡ç†</h3>
                    <p>config.json ã®å†…å®¹ã‚’ç·¨é›†ã§ãã¾ã™ã€‚å¤‰æ›´å¾Œã¯ã€Œè¨­å®šã‚’ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
                    
                    <!-- ã‚¢ãƒ—ãƒªæœ‰åŠ¹åŒ–è¨­å®š -->
                    <div class="config-section">
                        <h4>ğŸ“± æœ‰åŠ¹ãªã‚¢ãƒ—ãƒª</h4>
                        <div class="checkbox-list" id="enabledAppsCheckboxes">
                            <div class="loading">è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>

                    <!-- æ©Ÿèƒ½è¨­å®š -->
                    <div class="config-section">
                        <h4>âš™ï¸ æ©Ÿèƒ½è¨­å®š</h4>
                        <div class="checkbox-list" id="featuresCheckboxes">
                            <div class="loading">è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>

                    <!-- ä¿å­˜ãƒ»ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
                    <div style="margin: 20px 0;">
                        <button class="btn" onclick="loadConfigUI()">ğŸ“¥ è¨­å®šèª­ã¿è¾¼ã¿</button>
                        <button class="btn btn-secondary" onclick="saveConfigUI()">ğŸ’¾ è¨­å®šä¿å­˜</button>
                        <button class="btn btn-warning" onclick="resetConfig()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    
                    <!-- é«˜åº¦ãªè¨­å®šï¼ˆJSONç·¨é›†ï¼‰ -->
                    <div class="config-section">
                        <h4>ğŸ”§ é«˜åº¦ãªè¨­å®š (JSON)</h4>
                        <details>
                            <summary>ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘è¨­å®šç·¨é›†</summary>
                            <textarea class="config-editor" id="configEditor" placeholder="è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­..."></textarea>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" onclick="loadConfig()">ğŸ“¥ JSONèª­ã¿è¾¼ã¿</button>
                                <button class="btn btn-secondary" onclick="saveConfig()">ğŸ’¾ JSONä¿å­˜</button>
                            </div>
                        </details>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <div class="status status-warning">
                            <span>âš ï¸</span>
                            <span>è¨­å®šå¤‰æ›´å¾Œã¯ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ãŒå¿…è¦ã§ã™</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ã‚°é–²è¦§ç”»é¢ -->
            <div class="app-content" id="logs-content">
                <div class="logs-panel">
                    <h3>ğŸ“‹ ãƒ­ã‚°é–²è¦§</h3>
                    <p>ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸéå»ã®ãƒ­ã‚°ã‚’é–²è¦§ãƒ»æ¤œç´¢ã§ãã¾ã™ã€‚</p>
                    
                    <!-- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ -->
                    <div class="log-selection">
                        <h4>ğŸ“ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h4>
                        <div class="log-controls">
                            <button class="btn" onclick="loadLogFiles()">ğŸ”„ ãƒªã‚¹ãƒˆæ›´æ–°</button>
                            <button class="btn btn-secondary" onclick="loadAllLogs()">ğŸ“š å…¨ãƒ­ã‚°ä¸€æ‹¬è¡¨ç¤º</button>
                            <select id="logFileSelect" class="form-control" onchange="loadSelectedLog()">
                                <option value="">å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                    <div class="log-search">
                        <h4>ğŸ” æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h4>
                        <div class="search-controls">
                            <input type="text" id="logSearchInput" class="form-control" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›...">
                            <button class="btn" onclick="addKeywordFilter()">â• è¿½åŠ </button>
                            <button class="btn btn-secondary" onclick="clearAllKeywords()">ğŸ—‘ï¸ å…¨ã‚¯ãƒªã‚¢</button>
                            <span id="searchResultCount" class="search-count">0ä»¶</span>
                        </div>
                        <div id="keywordTags" class="keyword-tags"></div>
                    </div>
                    
                    <!-- ãƒ­ã‚°å†…å®¹è¡¨ç¤º -->
                    <div class="log-content">
                        <h4>ğŸ“„ ãƒ­ã‚°å†…å®¹</h4>
                        <div id="logDisplay" class="log-display">
                            ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å‹•çš„ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
                <div class="money-panel">
                    <h3>ğŸ’° ãŠé‡‘ç®¡ç†</h3>
                    
                    <!-- åæ”¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="input-section">
                        <h4>ğŸ“ åæ”¯è¨˜éŒ²</h4>
                        <div class="input-form">
                            <div class="form-row">
                                <select id="money-type" class="form-control">
                                    <option value="income">åå…¥</option>
                                    <option value="expense">æ”¯å‡º</option>
                                </select>
                                <input type="number" id="money-amount" class="form-control" placeholder="é‡‘é¡" min="0">
                            </div>
                            <div class="form-row">
                                <select id="money-category" class="form-control">
                                    <option value="çµ¦ä¸">çµ¦ä¸</option>
                                    <option value="å‰¯æ¥­">å‰¯æ¥­</option>
                                    <option value="ãƒœãƒ¼ãƒŠã‚¹">ãƒœãƒ¼ãƒŠã‚¹</option>
                                    <option value="é£Ÿè²»">é£Ÿè²»</option>
                                    <option value="äº¤é€šè²»">äº¤é€šè²»</option>
                                    <option value="å¨¯æ¥½è²»">å¨¯æ¥½è²»</option>
                                    <option value="å…‰ç†±è²»">å…‰ç†±è²»</option>
                                    <option value="å®¶è³ƒ">å®¶è³ƒ</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                                <input type="text" id="money-description" class="form-control" placeholder="èª¬æ˜ï¼ˆä»»æ„ï¼‰">
                            </div>
                            <div class="form-row">
                                <input type="date" id="money-date" class="form-control">
                                <button class="btn" onclick="addMoneyTransaction()">ğŸ’¾ è¨˜éŒ²</button>
                                <button class="btn btn-secondary" onclick="exportMoneyCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å–å¼•ä¸€è¦§ -->
                    <div class="transaction-list">
                        <h4>ğŸ“Š å–å¼•å±¥æ­´</h4>
                        <div id="money-transactions" class="transactions-display">
                            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ™‚é–“ç®¡ç†ç”»é¢ -->
            <div class="app-content" id="time-content" style="display: none;">
                <div class="time-panel">
                    <h3>â° æ™‚é–“ç®¡ç†</h3>
                    
                    <!-- æ™‚é–“è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="input-section">
                        <h4>ğŸ“ æ™‚é–“è¨˜éŒ²</h4>
                        <div class="input-form">
                            <div class="form-row">
                                <input type="text" id="time-task" class="form-control" placeholder="ã‚¿ã‚¹ã‚¯å">
                                <select id="time-category" class="form-control">
                                    <option value="ä»•äº‹">ä»•äº‹</option>
                                    <option value="å‹‰å¼·">å‹‰å¼·</option>
                                    <option value="é‹å‹•">é‹å‹•</option>
                                    <option value="ä¼‘æ†©">ä¼‘æ†©</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="number" id="time-hours" class="form-control" placeholder="æ™‚é–“" min="0" max="24">
                                <input type="number" id="time-minutes" class="form-control" placeholder="åˆ†" min="0" max="59">
                                <input type="date" id="time-date" class="form-control">
                            </div>
                            <div class="form-row">
                                <button class="btn" onclick="addTimeRecord()">ğŸ’¾ è¨˜éŒ²</button>
                                <button class="btn btn-secondary" onclick="exportTimeCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
                                <button class="btn btn-warning" onclick="startTimer()">â±ï¸ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
                    <div class="timer-section" id="timer-section" style="display: none;">
                        <h4>â±ï¸ ã‚¿ã‚¤ãƒãƒ¼</h4>
                        <div class="timer-display">
                            <div id="timer-display" class="timer-clock">00:00:00</div>
                            <div class="timer-controls">
                                <button class="btn" onclick="pauseTimer()">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
                                <button class="btn btn-danger" onclick="stopTimer()">â¹ï¸ åœæ­¢</button>
                            </div>
                            <div id="timer-task-name" class="timer-task"></div>
                        </div>
                    </div>
                    
                    <!-- æ™‚é–“è¨˜éŒ²ä¸€è¦§ -->
                    <div class="time-list">
                        <h4>ğŸ“Š æ™‚é–“è¨˜éŒ²å±¥æ­´</h4>
                        <div id="time-records" class="records-display">
                            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä½“é‡ç®¡ç†ç”»é¢ -->
            <div class="app-content" id="weight-content" style="display: none;">
                <div class="weight-panel">
                    <h3>âš–ï¸ ä½“é‡ç®¡ç†</h3>
                    
                    <!-- ä½“é‡è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="input-section">
                        <h4>ğŸ“ ä½“é‡è¨˜éŒ²</h4>
                        <div class="input-form">
                            <div class="form-row">
                                <input type="number" id="weight-value" class="form-control" placeholder="ä½“é‡ (kg)" step="0.1" min="20" max="300">
                                <input type="number" id="weight-height" class="form-control" placeholder="èº«é•· (cm)" min="100" max="250">
                                <input type="date" id="weight-date" class="form-control">
                            </div>
                            <div class="form-row">
                                <textarea id="weight-memo" class="form-control" placeholder="ãƒ¡ãƒ¢ï¼ˆä½“èª¿ãƒ»é£Ÿäº‹ãªã©ï¼‰" rows="2"></textarea>
                            </div>
                            <div class="form-row">
                                <button class="btn" onclick="addWeightRecord()">ğŸ’¾ è¨˜éŒ²</button>
                                <button class="btn btn-secondary" onclick="exportWeightCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
                                <button class="btn btn-warning" onclick="calculateBMI()">ğŸ“Š BMIè¨ˆç®—</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BMIè¡¨ç¤º -->
                    <div class="bmi-section" id="bmi-section" style="display: none;">
                        <h4>ğŸ“Š BMIè¨ˆç®—çµæœ</h4>
                        <div class="bmi-display">
                            <div id="bmi-result" class="bmi-value"></div>
                            <div id="bmi-status" class="bmi-status"></div>
                        </div>
                    </div>
                    
                    <!-- ä½“é‡è¨˜éŒ²ä¸€è¦§ -->
                    <div class="weight-list">
                        <h4>ğŸ“Š ä½“é‡è¨˜éŒ²å±¥æ­´</h4>
                        <div id="weight-records" class="records-display">
                            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ¡ãƒ¢ç®¡ç†ç”»é¢ -->
            <div class="app-content" id="memo-content" style="display: none;">
                <div class="memo-panel">
                    <h3>ğŸ“ ãƒ¡ãƒ¢ç®¡ç†</h3>
                    
                    <!-- ãƒ¡ãƒ¢ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="input-section">
                        <h4>ğŸ“ ãƒ¡ãƒ¢ä½œæˆ</h4>
                        <div class="input-form">
                            <div class="form-row">
                                <input type="text" id="memo-title" class="form-control" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
                                <select id="memo-category" class="form-control">
                                    <option value="ä»•äº‹">ä»•äº‹</option>
                                    <option value="ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ">ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ</option>
                                    <option value="å­¦ç¿’">å­¦ç¿’</option>
                                    <option value="ã‚¢ã‚¤ãƒ‡ã‚¢">ã‚¢ã‚¤ãƒ‡ã‚¢</option>
                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <textarea id="memo-textarea" class="form-control" placeholder="ãƒ¡ãƒ¢å†…å®¹" rows="4"></textarea>
                            </div>
                            <div class="form-row">
                                <input type="text" id="memo-tags" class="form-control" placeholder="ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰">
                                <button class="btn" onclick="addMemo()">ğŸ’¾ ä¿å­˜</button>
                                <button class="btn btn-secondary" onclick="exportMemoCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ -->
                    <div class="memo-filter-section">
                        <h4>ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h4>
                        <div class="filter-input-section">
                            <div class="form-row">
                                <input type="text" id="memo-filter-input" class="form-control" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
                                <button class="btn btn-secondary" onclick="addFilterKeyword()">ï¼‹ è¿½åŠ </button>
                                <button class="btn btn-warning" onclick="clearAllFilters()">ğŸ—‘ï¸ å…¨ã‚¯ãƒªã‚¢</button>
                            </div>
                        </div>
                        <div id="filter-keywords" class="filter-keywords">
                            <!-- è¿½åŠ ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                        </div>
                    </div>

                    <!-- ãƒ¡ãƒ¢ä¸€è¦§ -->
                    <div class="memo-list">
                        <h4>ğŸ“Š ãƒ¡ãƒ¢ä¸€è¦§</h4>
                        <div id="memo-records" class="memo-display">
                            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¨ˆç®—æ©Ÿç”»é¢ -->
            <div class="app-content" id="calc-content" style="display: none;">
                <div class="calc-panel">
                    <h3>ğŸ§® è¨ˆç®—æ©Ÿ</h3>
                    
                    <!-- è¨ˆç®—å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="input-section">
                        <h4>ğŸ§® æ•°å€¤è¨ˆç®—</h4>
                        <div class="calc-form">
                            <div class="calc-input-row">
                                <input type="number" id="calc-number-a" class="form-control calc-input" placeholder="æ•°å€¤A" step="any">
                                <span class="calc-operator">+</span>
                                <input type="number" id="calc-number-b" class="form-control calc-input" placeholder="æ•°å€¤B" step="any">
                                <span class="calc-equals">=</span>
                                <span id="calc-result" class="calc-result">?</span>
                            </div>
                            <div class="calc-button-row">
                                <button class="btn calc-btn" onclick="calculateNumbers()">ğŸ§® è¨ˆç®—å®Ÿè¡Œ</button>
                                <button class="btn btn-secondary" onclick="clearCalculation()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                                <button class="btn btn-secondary" onclick="exportCalcCSV()">ğŸ“¥ å±¥æ­´CSVå‡ºåŠ›</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è¨ˆç®—å±¥æ­´ -->
                    <div class="calc-history-section">
                        <h4>ğŸ“Š è¨ˆç®—å±¥æ­´</h4>
                        <div id="calc-history-list" class="calc-history-list">
                            <div class="loading">å±¥æ­´ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="log-section">
            <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
            <div class="log-controls">
                <button class="btn" onclick="downloadLogs()">ğŸ“¥ ãƒ­ã‚°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="btn btn-secondary" onclick="copyLogsToClipboard()">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼</button>
                <button class="btn" onclick="clearLogs()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
                <button class="btn" onclick="refreshLogs()">ğŸ”„ ãƒ­ã‚°æ›´æ–°</button>
            </div>
            <div class="debug-logs" id="debugLogs">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...</div>
        </div>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹
        class SmartTemplateApp {
            constructor() {
                this.currentUser = null;
                this.currentApp = 'welcome';
                this.config = null;
                this.loadedApps = [];
                this.logs = [];
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
                this.filterKeywords = [];
                this.maxFilterKeywords = 5;
                
                this.setupEventListeners();
                this.initialize();
                
                this.log('ğŸš€ çµ±åˆã‚¢ãƒ—ãƒªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v1.0 åˆæœŸåŒ–å®Œäº†');
            }

            async initialize() {
                try {
                    // Firebaseè¨­å®šèª­ã¿è¾¼ã¿
                    await this.loadFirebaseConfig();
                    
                    // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿
                    await this.loadSystemInfo();
                    
                    // è¨­å®šèª­ã¿è¾¼ã¿
                    await this.loadAppConfig();
                    
                    // èªè¨¼è¨­å®š
                    this.setupAuth();
                    
                    this.updateConnectionStatus('success', 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³');
                    this.log('âœ… åˆæœŸåŒ–å®Œäº†');
                    
                } catch (error) {
                    this.updateConnectionStatus('error', 'åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼');
                    this.log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // Firebaseè¨­å®šèª­ã¿è¾¼ã¿
            async loadFirebaseConfig() {
                try {
                    const response = await fetch('/api/firebase-config');
                    const firebaseConfig = await response.json();
                    
                    firebase.initializeApp(firebaseConfig);
                    this.auth = firebase.auth();
                    this.database = firebase.database();
                    
                    this.log('ğŸ”¥ FirebaseåˆæœŸåŒ–å®Œäº†');
                } catch (error) {
                    this.log(`âŒ FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿
            async loadSystemInfo() {
                try {
                    const response = await fetch('/api/info');
                    const info = await response.json();
                    
                    document.getElementById('appName').textContent = info.appName;
                    document.getElementById('version').textContent = `v${info.version}`;
                    document.getElementById('uptime').textContent = `${Math.floor(info.uptime / 60)}åˆ†`;
                    
                    if (info.moduleLoader) {
                        document.getElementById('enabledApps').textContent = 
                            `${info.moduleLoader.loadedAppsCount}å€‹`;
                    }
                    
                    this.log('ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿å®Œäº†');
                } catch (error) {
                    this.log(`âŒ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ã‚¢ãƒ—ãƒªè¨­å®šèª­ã¿è¾¼ã¿
            async loadAppConfig() {
                try {
                    const response = await fetch('/api/config');
                    const data = await response.json();
                    
                    this.config = data.config;
                    this.loadedApps = data.loadedApps || [];
                    
                    this.setupAppTabs();
                    this.log(`ğŸ“‹ è¨­å®šèª­ã¿è¾¼ã¿å®Œäº† | ${this.loadedApps.length}å€‹ã®ã‚¢ãƒ—ãƒª`);
                } catch (error) {
                    this.log(`âŒ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ã‚¢ãƒ—ãƒªã‚¿ãƒ–è¨­å®š
            setupAppTabs() {
                const tabsContainer = document.getElementById('appTabs');
                
                // æ—¢å­˜ã®å‹•çš„ã‚¿ãƒ–ã‚’å‰Šé™¤
                const dynamicTabs = tabsContainer.querySelectorAll('.app-tab[data-dynamic="true"]');
                dynamicTabs.forEach(tab => tab.remove());
                
                // ã‚¢ãƒ—ãƒªã‚¿ãƒ–ã‚’è¿½åŠ 
                this.loadedApps.forEach(app => {
                    const tab = document.createElement('button');
                    tab.className = 'app-tab';
                    tab.setAttribute('data-app', app.name);
                    tab.setAttribute('data-dynamic', 'true');
                    tab.innerHTML = `
                        <span class="icon">${app.icon}</span>
                        <span>${app.displayName}</span>
                    `;
                    tabsContainer.appendChild(tab);
                    
                    // ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                    tab.addEventListener('click', () => this.switchApp(app.name));
                    
                    // ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸã‚’ä½œæˆ
                    this.createAppContent(app);
                });
            }

            // ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ
            createAppContent(app) {
                const mainContent = document.querySelector('.main-content');
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'app-content';
                contentDiv.id = `${app.name}-content`;
                contentDiv.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h2>${app.icon} ${app.displayName}</h2>
                        <p>${app.description || 'ã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ'}</p>
                        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> ${app.version}</p>
                        <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${app.status}</p>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn" onclick="app.testAppAPI('${app.name}')">
                                ğŸ”— ${app.displayName} API ãƒ†ã‚¹ãƒˆ
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; text-align: left;">
                            <h4>åˆ©ç”¨å¯èƒ½ãªAPI:</h4>
                            <ul style="margin-top: 10px;">
                                <li>GET /api/${app.name}/* - ãƒ‡ãƒ¼ã‚¿å–å¾—</li>
                                <li>POST /api/${app.name}/* - ãƒ‡ãƒ¼ã‚¿è¿½åŠ </li>
                                <li>DELETE /api/${app.name}/* - ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</li>
                                <li>POST /api/${app.name}/export/csv - CSVå‡ºåŠ›</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                mainContent.appendChild(contentDiv);
            }

            // ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆ
            switchApp(appName) {
                // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.app-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-app="${appName}"]`).classList.add('active');
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.app-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                const targetContent = document.getElementById(`${appName}-content`);
                if (targetContent) {
                    targetContent.style.display = 'block';
                    
                    // ã‚¢ãƒ—ãƒªå›ºæœ‰ã®åˆæœŸåŒ–
                    if (appName === 'money') {
                        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
                        const today = new Date().toISOString().split('T')[0];
                        const dateInput = document.getElementById('money-date');
                        if (dateInput) {
                            dateInput.value = today;
                        }
                        
                        // å–å¼•å±¥æ­´ã‚’èª­ã¿è¾¼ã¿
                        this.loadMoneyTransactions();
                    } else if (appName === 'time') {
                        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
                        const today = new Date().toISOString().split('T')[0];
                        const dateInput = document.getElementById('time-date');
                        if (dateInput) {
                            dateInput.value = today;
                        }
                        
                        // æ™‚é–“è¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿
                        this.loadTimeRecords();
                    } else if (appName === 'weight') {
                        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
                        const today = new Date().toISOString().split('T')[0];
                        const dateInput = document.getElementById('weight-date');
                        if (dateInput) {
                            dateInput.value = today;
                        }
                        
                        // ä½“é‡è¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿
                        this.loadWeightRecords();
                    } else if (appName === 'memo') {
                        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡¨ç¤ºã‚’åˆæœŸåŒ–
                        this.updateFilterKeywordsDisplay();
                        // ãƒ¡ãƒ¢ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
                        this.loadMemos();
                    } else if (appName === 'calc') {
                        // è¨ˆç®—å±¥æ­´ã‚’èª­ã¿è¾¼ã¿
                        this.loadCalcHistory();
                    }
                    
                    // è¨­å®šç”»é¢ã®å ´åˆã¯è¨­å®šUIã‚’åˆæœŸåŒ–
                    if (appName === 'settings') {
                        this.loadConfigUI();
                    }
                }
                
                this.currentApp = appName;
                this.log(`ğŸ”„ ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆ | ${appName}`);
            }

            // èªè¨¼è¨­å®š
            setupAuth() {
                if (!this.auth) return;
                
                this.auth.onAuthStateChanged((user) => {
                    this.currentUser = user;
                    this.updateAuthUI();
                    
                    if (user) {
                        this.log(`ğŸ‘¤ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ | ${user.email}`);
                    } else {
                        this.log('ğŸ‘¤ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ');
                    }
                });
            }

            // èªè¨¼UIæ›´æ–°
            updateAuthUI() {
                const authBtn = document.getElementById('authBtn');
                
                if (this.currentUser) {
                    authBtn.textContent = 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ';
                    authBtn.onclick = () => this.signOut();
                } else {
                    authBtn.textContent = 'Googleã§ãƒ­ã‚°ã‚¤ãƒ³';
                    authBtn.onclick = () => this.signIn();
                }
            }

            // ãƒ­ã‚°ã‚¤ãƒ³
            async signIn() {
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    await this.auth.signInWithPopup(provider);
                } catch (error) {
                    this.log(`âŒ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            async signOut() {
                try {
                    await this.auth.signOut();
                } catch (error) {
                    this.log(`âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            updateConnectionStatus(type, message) {
                const status = document.getElementById('connectionStatus');
                status.className = `status status-${type}`;
                status.innerHTML = `<span>${type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'âŒ'}</span><span>${message}</span>`;
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners() {
                // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.app-tab')) {
                        const tab = e.target.closest('.app-tab');
                        const appName = tab.getAttribute('data-app');
                        this.switchApp(appName);
                    }
                });
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¥åŠ›ã§Enterã‚­ãƒ¼æŠ¼ä¸‹æ™‚ã«è¿½åŠ 
                document.addEventListener('keypress', (e) => {
                    if (e.target.id === 'memo-filter-input' && e.key === 'Enter') {
                        e.preventDefault();
                        this.addFilterKeyword();
                    }
                });
            }

            // API ãƒ†ã‚¹ãƒˆ
            async testAPI() {
                try {
                    this.log('ğŸ”— APIæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹');
                    
                    const response = await fetch('/api/health');
                    const data = await response.json();
                    
                    if (data.status === 'OK') {
                        this.log('âœ… APIæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ');
                        this.updateConnectionStatus('success', 'APIæ­£å¸¸');
                    } else {
                        this.log('âŒ APIæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—');
                        this.updateConnectionStatus('error', 'APIç•°å¸¸');
                    }
                } catch (error) {
                    this.log(`âŒ APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    this.updateConnectionStatus('error', 'APIæ¥ç¶šã‚¨ãƒ©ãƒ¼');
                }
            }

            // ã‚¢ãƒ—ãƒªå€‹åˆ¥API ãƒ†ã‚¹ãƒˆ
            async testAppAPI(appName) {
                try {
                    this.log(`ğŸ”— ${appName} API ãƒ†ã‚¹ãƒˆé–‹å§‹`);
                    
                    // ã‚¢ãƒ—ãƒªå›ºæœ‰ã®ãƒ†ã‚¹ãƒˆAPIã‚’å‘¼ã³å‡ºã—
                    const response = await fetch(`/api/${appName}/sample-data`, {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.log(`âœ… ${appName} API ãƒ†ã‚¹ãƒˆæˆåŠŸ`);
                    } else {
                        this.log(`âŒ ${appName} API ãƒ†ã‚¹ãƒˆå¤±æ•—`);
                    }
                } catch (error) {
                    this.log(`âŒ ${appName} API ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            async generateSampleData() {
                try {
                    this.log('ğŸ¯ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹');
                    
                    for (const app of this.loadedApps) {
                        await this.testAppAPI(app.name);
                    }
                    
                    this.log('âœ… å…¨ã‚¢ãƒ—ãƒªã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†');
                } catch (error) {
                    this.log(`âŒ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // è¨­å®šé–¢é€£æ©Ÿèƒ½
            async loadConfig() {
                try {
                    const response = await fetch('/api/config');
                    const data = await response.json();
                    
                    document.getElementById('configEditor').value = 
                        JSON.stringify(data.config, null, 2);
                    
                    this.log('ğŸ“¥ è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†');
                } catch (error) {
                    this.log(`âŒ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async saveConfig() {
                try {
                    const configText = document.getElementById('configEditor').value;
                    const config = JSON.parse(configText);
                    
                    const response = await fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(config)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.log('ğŸ’¾ è¨­å®šä¿å­˜å®Œäº†');
                        alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚å¤‰æ›´ã‚’åæ˜ ã™ã‚‹ã«ã¯ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚');
                    } else {
                        throw new Error(data.error || 'è¨­å®šä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    alert(`è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }

            async resetConfig() {
                if (confirm('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    await this.loadConfig();
                    this.log('ğŸ”„ è¨­å®šãƒªã‚»ãƒƒãƒˆå®Œäº†');
                }
            }

            // ãŠé‡‘ç®¡ç†æ©Ÿèƒ½
            async addMoneyTransaction() {
                const type = document.getElementById('money-type').value;
                const amount = parseFloat(document.getElementById('money-amount').value);
                const category = document.getElementById('money-category').value;
                const description = document.getElementById('money-description').value;
                const date = document.getElementById('money-date').value || new Date().toISOString().split('T')[0];

                if (!amount || amount <= 0) {
                    alert('æ­£ã—ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                const transaction = {
                    id: Date.now().toString(),
                    type,
                    amount,
                    category,
                    description,
                    date,
                    timestamp: new Date().toISOString(),
                    userId: this.currentUser ? this.currentUser.uid : 'anonymous'
                };

                try {
                    // Firebase Realtime Databaseã«ä¿å­˜
                    if (this.database && this.currentUser) {
                        await this.database.ref(`transactions/${this.currentUser.uid}/${transaction.id}`).set(transaction);
                        this.log(`ğŸ’° å–å¼•ã‚’Firebaseã«ä¿å­˜ | ${type} ${amount}å††`);
                    }

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚‚ä¿å­˜
                    this.saveTransactionLocal(transaction);
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    document.getElementById('money-amount').value = '';
                    document.getElementById('money-description').value = '';
                    
                    // å–å¼•ä¸€è¦§ã‚’æ›´æ–°
                    this.loadMoneyTransactions();
                    
                    this.log(`ğŸ’° å–å¼•è¨˜éŒ²å®Œäº† | ${type} ${amount}å†† (${category})`);
                } catch (error) {
                    this.log(`âŒ å–å¼•ä¿å­˜ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            saveTransactionLocal(transaction) {
                let transactions = JSON.parse(localStorage.getItem('moneyTransactions') || '[]');
                transactions.push(transaction);
                localStorage.setItem('moneyTransactions', JSON.stringify(transactions));
            }

            async loadMoneyTransactions() {
                try {
                    let transactions = [];
                    
                    // Firebase ã‹ã‚‰å–å¾—
                    if (this.database && this.currentUser) {
                        const snapshot = await this.database.ref(`transactions/${this.currentUser.uid}`).once('value');
                        if (snapshot.exists()) {
                            transactions = Object.values(snapshot.val());
                        }
                    }
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚‚å–å¾—ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
                    const localTransactions = JSON.parse(localStorage.getItem('moneyTransactions') || '[]');
                    
                    // ãƒãƒ¼ã‚¸ï¼ˆé‡è¤‡é™¤å»ï¼‰
                    const allTransactions = [...transactions, ...localTransactions];
                    const uniqueTransactions = allTransactions.filter((trans, index, self) =>
                        index === self.findIndex(t => t.id === trans.id)
                    );
                    
                    // æ—¥ä»˜é †ã§ã‚½ãƒ¼ãƒˆ
                    uniqueTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    this.displayTransactions(uniqueTransactions);
                } catch (error) {
                    this.log(`âŒ å–å¼•èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            displayTransactions(transactions) {
                const container = document.getElementById('money-transactions');
                
                if (transactions.length === 0) {
                    container.innerHTML = '<p>å–å¼•å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    return;
                }
                
                let html = '';
                let totalIncome = 0;
                let totalExpense = 0;
                
                transactions.forEach(trans => {
                    const isIncome = trans.type === 'income';
                    const amount = parseFloat(trans.amount);
                    
                    if (isIncome) {
                        totalIncome += amount;
                    } else {
                        totalExpense += amount;
                    }
                    
                    html += `
                        <div class="transaction-item ${isIncome ? 'transaction-income' : 'transaction-expense'}">
                            <div>
                                <strong>${trans.date}</strong> | ${trans.category}
                                ${trans.description ? ` - ${trans.description}` : ''}
                            </div>
                            <div>
                                <span style="color: ${isIncome ? 'green' : 'red'}">
                                    ${isIncome ? '+' : '-'}${amount.toLocaleString()}å††
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                const balance = totalIncome - totalExpense;
                html = `
                    <div style="background: #e9ecef; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
                        <strong>æ®‹é«˜: ${balance.toLocaleString()}å††</strong> 
                        (åå…¥: ${totalIncome.toLocaleString()}å††, æ”¯å‡º: ${totalExpense.toLocaleString()}å††)
                    </div>
                ` + html;
                
                container.innerHTML = html;
            }

            async exportMoneyCSV() {
                try {
                    const response = await fetch('/api/money/export/csv', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            startDate: null,
                            endDate: null,
                            type: null
                        })
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `money_transactions_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        this.log('ğŸ“¥ CSVå‡ºåŠ›å®Œäº†');
                    }
                } catch (error) {
                    this.log(`âŒ CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ãƒ­ã‚°ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
            async copyLogsToClipboard() {
                try {
                    const logContainer = document.getElementById('debugLogs');
                    const logText = logContainer.textContent || logContainer.innerText;
                    
                    // ãƒ­ã‚°ãŒç©ºã®å ´åˆ
                    if (!logText || logText === 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...') {
                        this.log('âŒ ã‚³ãƒ”ãƒ¼å¯èƒ½ãªãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“');
                        alert('ã‚³ãƒ”ãƒ¼å¯èƒ½ãªãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“');
                        return;
                    }
                    
                    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIå¯¾å¿œãƒã‚§ãƒƒã‚¯
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(logText);
                        this.log('ğŸ“‹ ãƒ­ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼å®Œäº†');
                        
                        // æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                        const button = document.querySelector('[onclick="copyLogsToClipboard()"]');
                        const originalText = button.textContent;
                        button.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†';
                        button.style.background = '#4CAF50';
                        
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.style.background = '';
                        }, 2000);
                        
                    } else {
                        // å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        const textArea = document.createElement('textarea');
                        textArea.value = logText;
                        textArea.style.position = 'fixed';
                        textArea.style.opacity = '0';
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        this.log('ğŸ“‹ ãƒ­ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼å®Œäº†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰');
                        alert('ãƒ­ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                    }
                    
                } catch (error) {
                    this.log(`âŒ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }

            // æ™‚é–“ç®¡ç†æ©Ÿèƒ½
            timer = {
                interval: null,
                seconds: 0,
                isRunning: false,
                taskName: ''
            };

            async addTimeRecord() {
                this.log('â° æ™‚é–“è¨˜éŒ²ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const task = document.getElementById('time-task').value;
                const category = document.getElementById('time-category').value;
                const hours = parseInt(document.getElementById('time-hours').value) || 0;
                const minutes = parseInt(document.getElementById('time-minutes').value) || 0;
                const date = document.getElementById('time-date').value || new Date().toISOString().split('T')[0];

                if (!task) {
                    this.log('âŒ ã‚¿ã‚¹ã‚¯åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    alert('ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                if (hours === 0 && minutes === 0) {
                    this.log('âŒ æ™‚é–“ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    alert('æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                const timeRecord = {
                    id: Date.now().toString(),
                    task,
                    category,
                    hours,
                    minutes,
                    totalMinutes: hours * 60 + minutes,
                    date,
                    timestamp: new Date().toISOString(),
                    userId: this.currentUser ? this.currentUser.uid : 'anonymous'
                };

                try {
                    const response = await fetch('/api/time/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(timeRecord)
                    });

                    if (response.ok) {
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                        document.getElementById('time-task').value = '';
                        document.getElementById('time-hours').value = '';
                        document.getElementById('time-minutes').value = '';
                        
                        this.loadTimeRecords();
                        this.log(`â° æ™‚é–“è¨˜éŒ²å®Œäº† | ${task} ${hours}æ™‚é–“${minutes}åˆ† (${category})`);
                    } else {
                        this.log('âŒ æ™‚é–“è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ æ™‚é–“è¨˜éŒ²ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async loadTimeRecords() {
                this.log('â° æ™‚é–“è¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                try {
                    const response = await fetch('/api/time/data');
                    const result = await response.json();
                    
                    const container = document.getElementById('time-records');
                    
                    if (result.data && result.data.length === 0) {
                        container.innerHTML = '<p>æ™‚é–“è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                        return;
                    }
                    
                    let html = '';
                    let totalMinutes = 0;
                    
                    if (result.data) {
                        result.data.forEach(record => {
                            totalMinutes += record.totalMinutes || 0;
                            
                            html += `
                                <div class="record-item record-${record.category.toLowerCase()}">
                                    <div>
                                        <strong>${record.date}</strong> | ${record.task}
                                        <br><small>${record.category}</small>
                                    </div>
                                    <div>
                                        <span>${record.hours || 0}æ™‚é–“${record.minutes || 0}åˆ†</span>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    const totalHours = Math.floor(totalMinutes / 60);
                    const remainingMinutes = totalMinutes % 60;
                    
                    html = `
                        <div style="background: #e9ecef; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
                            <strong>åˆè¨ˆæ™‚é–“: ${totalHours}æ™‚é–“${remainingMinutes}åˆ†</strong>
                        </div>
                    ` + html;
                    
                    container.innerHTML = html || '<p>æ™‚é–“è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    this.log('â° æ™‚é–“è¨˜éŒ²ã®èª­ã¿è¾¼ã¿å®Œäº†');
                } catch (error) {
                    this.log(`âŒ æ™‚é–“è¨˜éŒ²èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    document.getElementById('time-records').innerHTML = '<p>æ™‚é–“è¨˜éŒ²ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }

            startTimer() {
                this.log('â±ï¸ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const task = document.getElementById('time-task').value;
                if (!task) {
                    this.log('âŒ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹: ã‚¿ã‚¹ã‚¯åãŒå¿…è¦ã§ã™');
                    alert('ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã—ã¦ãã ã•ã„');
                    return;
                }

                this.timer.taskName = task;
                this.timer.seconds = 0;
                this.timer.isRunning = true;
                
                document.getElementById('timer-section').style.display = 'block';
                document.getElementById('timer-task-name').textContent = `å®Ÿè¡Œä¸­: ${task}`;
                
                this.timer.interval = setInterval(() => {
                    this.timer.seconds++;
                    this.updateTimerDisplay();
                }, 1000);
                
                this.log(`â±ï¸ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ | ã‚¿ã‚¹ã‚¯: ${task}`);
            }

            pauseTimer() {
                this.log('â¸ï¸ ã‚¿ã‚¤ãƒãƒ¼ä¸€æ™‚åœæ­¢');
                
                if (this.timer.interval) {
                    clearInterval(this.timer.interval);
                    this.timer.interval = null;
                    this.timer.isRunning = false;
                }
            }

            stopTimer() {
                this.log('â¹ï¸ ã‚¿ã‚¤ãƒãƒ¼åœæ­¢');
                
                if (this.timer.interval) {
                    clearInterval(this.timer.interval);
                    this.timer.interval = null;
                }
                
                const hours = Math.floor(this.timer.seconds / 3600);
                const minutes = Math.floor((this.timer.seconds % 3600) / 60);
                
                // è‡ªå‹•ã§æ™‚é–“ã‚’å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®š
                document.getElementById('time-hours').value = hours;
                document.getElementById('time-minutes').value = minutes;
                
                document.getElementById('timer-section').style.display = 'none';
                this.timer.seconds = 0;
                this.timer.isRunning = false;
                
                this.log(`â¹ï¸ ã‚¿ã‚¤ãƒãƒ¼åœæ­¢ | çµŒéæ™‚é–“: ${hours}æ™‚é–“${minutes}åˆ†`);
            }

            updateTimerDisplay() {
                const hours = Math.floor(this.timer.seconds / 3600);
                const minutes = Math.floor((this.timer.seconds % 3600) / 60);
                const seconds = this.timer.seconds % 60;
                
                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer-display').textContent = display;
            }

            async exportTimeCSV() {
                this.log('ğŸ“¥ æ™‚é–“ç®¡ç†CSVå‡ºåŠ›ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                try {
                    const response = await fetch('/api/time/export/csv', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `time_records_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        this.log('ğŸ“¥ æ™‚é–“ç®¡ç†CSVå‡ºåŠ›å®Œäº†');
                    } else {
                        this.log('âŒ æ™‚é–“ç®¡ç†CSVå‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ æ™‚é–“ç®¡ç†CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ä½“é‡ç®¡ç†æ©Ÿèƒ½
            async addWeightRecord() {
                this.log('âš–ï¸ ä½“é‡è¨˜éŒ²ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const weight = parseFloat(document.getElementById('weight-value').value);
                const height = parseFloat(document.getElementById('weight-height').value);
                const date = document.getElementById('weight-date').value || new Date().toISOString().split('T')[0];
                const memo = document.getElementById('weight-memo').value;

                if (!weight) {
                    this.log('âŒ ä½“é‡ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    alert('ä½“é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                const weightRecord = {
                    id: Date.now().toString(),
                    weight,
                    height,
                    date,
                    memo,
                    timestamp: new Date().toISOString(),
                    userId: this.currentUser ? this.currentUser.uid : 'anonymous'
                };

                // BMIè¨ˆç®—
                if (height) {
                    weightRecord.bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);
                }

                try {
                    const response = await fetch('/api/weight/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(weightRecord)
                    });

                    if (response.ok) {
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                        document.getElementById('weight-value').value = '';
                        document.getElementById('weight-memo').value = '';
                        
                        this.loadWeightRecords();
                        this.log(`âš–ï¸ ä½“é‡è¨˜éŒ²å®Œäº† | ${weight}kg ${height ? `BMI:${weightRecord.bmi}` : ''}`);
                    } else {
                        this.log('âŒ ä½“é‡è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ä½“é‡è¨˜éŒ²ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async loadWeightRecords() {
                this.log('âš–ï¸ ä½“é‡è¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                try {
                    const response = await fetch('/api/weight/data');
                    const result = await response.json();
                    
                    const container = document.getElementById('weight-records');
                    
                    if (result.data && result.data.length === 0) {
                        container.innerHTML = '<p>ä½“é‡è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                        return;
                    }
                    
                    let html = '';
                    
                    if (result.data) {
                        result.data.forEach(record => {
                            html += `
                                <div class="record-item">
                                    <div>
                                        <strong>${record.date}</strong> | ${record.weight}kg
                                        ${record.bmi ? ` | BMI: ${record.bmi}` : ''}
                                        ${record.memo ? `<br><small>${record.memo}</small>` : ''}
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    container.innerHTML = html || '<p>ä½“é‡è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    this.log('âš–ï¸ ä½“é‡è¨˜éŒ²ã®èª­ã¿è¾¼ã¿å®Œäº†');
                } catch (error) {
                    this.log(`âŒ ä½“é‡è¨˜éŒ²èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    document.getElementById('weight-records').innerHTML = '<p>ä½“é‡è¨˜éŒ²ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }

            calculateBMI() {
                this.log('ğŸ“Š BMIè¨ˆç®—ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const weight = parseFloat(document.getElementById('weight-value').value);
                const height = parseFloat(document.getElementById('weight-height').value);

                if (!weight || !height) {
                    this.log('âŒ BMIè¨ˆç®—: ä½“é‡ã¨èº«é•·ãŒå¿…è¦ã§ã™');
                    alert('ä½“é‡ã¨èº«é•·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);
                let status = '';
                let statusClass = '';

                if (bmi < 18.5) {
                    status = 'ä½ä½“é‡';
                    statusClass = 'bmi-underweight';
                } else if (bmi < 25) {
                    status = 'æ™®é€šä½“é‡';
                    statusClass = 'bmi-normal';
                } else if (bmi < 30) {
                    status = 'è‚¥æº€ï¼ˆ1åº¦ï¼‰';
                    statusClass = 'bmi-overweight';
                } else {
                    status = 'è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰';
                    statusClass = 'bmi-obese';
                }

                document.getElementById('bmi-result').textContent = `BMI: ${bmi}`;
                document.getElementById('bmi-status').textContent = status;
                document.getElementById('bmi-status').className = `bmi-status ${statusClass}`;
                document.getElementById('bmi-section').style.display = 'block';

                this.log(`ğŸ“Š BMIè¨ˆç®—å®Œäº† | BMI: ${bmi} (${status})`);
            }

            async exportWeightCSV() {
                this.log('ğŸ“¥ ä½“é‡ç®¡ç†CSVå‡ºåŠ›ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                try {
                    const response = await fetch('/api/weight/export/csv', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `weight_records_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        this.log('ğŸ“¥ ä½“é‡ç®¡ç†CSVå‡ºåŠ›å®Œäº†');
                    } else {
                        this.log('âŒ ä½“é‡ç®¡ç†CSVå‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ä½“é‡ç®¡ç†CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
            addFilterKeyword() {
                const input = document.getElementById('memo-filter-input');
                const keyword = input.value.trim();
                
                if (!keyword) {
                    this.log('âŒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒç©ºã§ã™');
                    alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                if (this.filterKeywords.includes(keyword)) {
                    this.log('âŒ åŒã˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™');
                    alert('åŒã˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                    return;
                }
                
                if (this.filterKeywords.length >= this.maxFilterKeywords) {
                    this.log(`âŒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯æœ€å¤§${this.maxFilterKeywords}å€‹ã¾ã§`);
                    alert(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯æœ€å¤§${this.maxFilterKeywords}å€‹ã¾ã§è¿½åŠ ã§ãã¾ã™`);
                    return;
                }
                
                this.filterKeywords.push(keyword);
                input.value = '';
                
                this.updateFilterKeywordsDisplay();
                this.applyMemoFilter();
                
                this.log(`ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ  | ${keyword} (${this.filterKeywords.length}/${this.maxFilterKeywords})`);
            }

            removeFilterKeyword(keyword) {
                const index = this.filterKeywords.indexOf(keyword);
                if (index > -1) {
                    this.filterKeywords.splice(index, 1);
                    this.updateFilterKeywordsDisplay();
                    this.applyMemoFilter();
                    
                    this.log(`ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‰Šé™¤ | ${keyword} (${this.filterKeywords.length}/${this.maxFilterKeywords})`);
                }
            }

            clearAllFilters() {
                if (this.filterKeywords.length === 0) {
                    this.log('ğŸ“ ã‚¯ãƒªã‚¢ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                this.filterKeywords = [];
                this.updateFilterKeywordsDisplay();
                this.applyMemoFilter();
                
                this.log('ğŸ—‘ï¸ å…¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }

            updateFilterKeywordsDisplay() {
                const container = document.getElementById('filter-keywords');
                
                if (this.filterKeywords.length === 0) {
                    container.innerHTML = '<div class="filter-empty-state">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã—ï¼ˆæœ€å¤§5å€‹ã¾ã§è¿½åŠ å¯èƒ½ï¼‰</div>';
                    return;
                }
                
                let html = '';
                this.filterKeywords.forEach(keyword => {
                    html += `
                        <div class="filter-keyword-tag">
                            <span>${keyword}</span>
                            <button class="remove-btn" onclick="app.removeFilterKeyword('${keyword}')" title="å‰Šé™¤">Ã—</button>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            applyMemoFilter() {
                if (this.filterKeywords.length === 0) {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—ã®å ´åˆã¯å…¨ãƒ¡ãƒ¢ã‚’è¡¨ç¤º
                    this.loadMemos();
                    return;
                }
                
                // ç¾åœ¨ã®ãƒ¡ãƒ¢ä¸€è¦§ã‚’å–å¾—ã—ã¦å†ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                this.filterCurrentMemos();
            }

            async filterCurrentMemos() {
                try {
                    const response = await fetch('/api/memo/data');
                    const result = await response.json();
                    
                    if (!result.data) {
                        return;
                    }
                    
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨
                    const filteredMemos = result.data.filter(memo => {
                        const searchableText = [
                            memo.title,
                            memo.content,
                            memo.category,
                            ...(Array.isArray(memo.tags) ? memo.tags : [])
                        ].join(' ').toLowerCase();
                        
                        // å…¨ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼ˆANDæ¤œç´¢ï¼‰
                        return this.filterKeywords.every(keyword => 
                            searchableText.includes(keyword.toLowerCase())
                        );
                    });
                    
                    this.displayFilteredMemos(filteredMemos);
                    
                    this.log(`ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨å®Œäº† | ${filteredMemos.length}ä»¶è¡¨ç¤º (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${this.filterKeywords.join(', ')})`);
                } catch (error) {
                    this.log(`âŒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            displayFilteredMemos(memos) {
                const container = document.getElementById('memo-records');
                
                if (memos.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #666;">
                            <p>ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <p>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${this.filterKeywords.join(', ')}</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                memos.forEach(memo => {
                    const tagsHtml = Array.isArray(memo.tags) ? 
                        memo.tags.map(tag => `<span class="memo-tag">${tag}</span>`).join('') : '';
                    
                    html += `
                        <div class="memo-item">
                            <div class="memo-header">
                                <span class="memo-title">${memo.title}</span>
                                <span class="memo-category">${memo.category}</span>
                            </div>
                            <div class="memo-content">${memo.content}</div>
                            <div class="memo-meta">
                                <div>
                                    <span>${memo.date}</span>
                                    <div class="memo-tags">${tagsHtml}</div>
                                </div>
                                <button class="memo-delete-btn" onclick="deleteMemo('${memo.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
                            </div>
                        </div>
                    `;
                });
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœã®ã‚µãƒãƒªãƒ¼ã‚’å…ˆé ­ã«è¿½åŠ 
                html = `
                    <div style="background: #e9ecef; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
                        <strong>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ: ${memos.length}ä»¶</strong> 
                        (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${this.filterKeywords.join(', ')})
                    </div>
                ` + html;
                
                container.innerHTML = html;
            }

            // ãƒ¡ãƒ¢ç®¡ç†æ©Ÿèƒ½
            async addMemo() {
                this.log('ğŸ“ ãƒ¡ãƒ¢ä¿å­˜ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const title = document.getElementById('memo-title').value;
                const content = document.getElementById('memo-textarea').value;
                const category = document.getElementById('memo-category').value;
                const tagsInput = document.getElementById('memo-tags').value;

                if (!title || !content) {
                    this.log('âŒ ã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ãŒå¿…è¦ã§ã™');
                    alert('ã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];

                const memo = {
                    title,
                    content,
                    category,
                    tags,
                    userId: this.currentUser ? this.currentUser.uid : 'anonymous'
                };

                try {
                    const response = await fetch('/api/memo/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(memo)
                    });

                    if (response.ok) {
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                        document.getElementById('memo-title').value = '';
                        document.getElementById('memo-textarea').value = '';
                        document.getElementById('memo-tags').value = '';
                        
                        this.loadMemos();
                        this.log(`ğŸ“ ãƒ¡ãƒ¢ä¿å­˜å®Œäº† | ${title} (${category})`);
                    } else {
                        this.log('âŒ ãƒ¡ãƒ¢ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ãƒ¡ãƒ¢ä¿å­˜ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async loadMemos() {
                this.log('ğŸ“ ãƒ¡ãƒ¢ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                try {
                    const response = await fetch('/api/memo/data');
                    const result = await response.json();
                    
                    const container = document.getElementById('memo-records');
                    
                    if (result.data && result.data.length === 0) {
                        container.innerHTML = '<p>ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                        return;
                    }
                    
                    let html = '';
                    
                    if (result.data) {
                        result.data.forEach(memo => {
                            const tagsHtml = Array.isArray(memo.tags) ? 
                                memo.tags.map(tag => `<span class="memo-tag">${tag}</span>`).join('') : '';
                            
                            html += `
                                <div class="memo-item">
                                    <div class="memo-header">
                                        <span class="memo-title">${memo.title}</span>
                                        <span class="memo-category">${memo.category}</span>
                                    </div>
                                    <div class="memo-content">${memo.content}</div>
                                    <div class="memo-meta">
                                        <div>
                                            <span>${memo.date}</span>
                                            <div class="memo-tags">${tagsHtml}</div>
                                        </div>
                                        <button class="memo-delete-btn" onclick="deleteMemo('${memo.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    container.innerHTML = html || '<p>ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    this.log('ğŸ“ ãƒ¡ãƒ¢ä¸€è¦§ã®èª­ã¿è¾¼ã¿å®Œäº†');
                } catch (error) {
                    this.log(`âŒ ãƒ¡ãƒ¢èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    document.getElementById('memo-records').innerHTML = '<p>ãƒ¡ãƒ¢ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }

            async deleteMemo(memoId) {
                this.log(`ğŸ—‘ï¸ ãƒ¡ãƒ¢å‰Šé™¤ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ | ID: ${memoId}`);
                
                if (!confirm('ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.log('ğŸ“ ãƒ¡ãƒ¢å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                    return;
                }

                try {
                    const response = await fetch(`/api/memo/delete/${memoId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        this.loadMemos();
                        this.log(`ğŸ—‘ï¸ ãƒ¡ãƒ¢å‰Šé™¤å®Œäº† | ID: ${memoId}`);
                    } else {
                        this.log('âŒ ãƒ¡ãƒ¢ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ãƒ¡ãƒ¢å‰Šé™¤ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async exportMemoCSV() {
                this.log('ğŸ“¥ ãƒ¡ãƒ¢CSVå‡ºåŠ›ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                try {
                    const response = await fetch('/api/memo/export/csv', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `memo_data_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        this.log('ğŸ“¥ ãƒ¡ãƒ¢CSVå‡ºåŠ›å®Œäº†');
                    } else {
                        this.log('âŒ ãƒ¡ãƒ¢CSVå‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ãƒ¡ãƒ¢CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ================================================================
            // è¨ˆç®—æ©Ÿç®¡ç†æ©Ÿèƒ½
            // ================================================================
            async calculateNumbers() {
                this.log('ğŸ§® è¨ˆç®—å®Ÿè¡Œãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                const numberA = parseFloat(document.getElementById('calc-number-a').value);
                const numberB = parseFloat(document.getElementById('calc-number-b').value);
                const resultElement = document.getElementById('calc-result');

                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (isNaN(numberA) || isNaN(numberB)) {
                    this.log('âŒ æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    alert('æ•°å€¤A ã¨ æ•°å€¤B ã«æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    resultElement.textContent = '?';
                    return;
                }

                try {
                    const response = await fetch('/api/calc/calculate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            numberA: numberA,
                            numberB: numberB,
                            operation: 'add'
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        resultElement.textContent = result.calculation.result;
                        
                        this.loadCalcHistory();
                        this.log(`ğŸ§® è¨ˆç®—å®Œäº† | ${numberA} + ${numberB} = ${result.calculation.result}`);
                    } else {
                        this.log('âŒ è¨ˆç®—å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        resultElement.textContent = 'ã‚¨ãƒ©ãƒ¼';
                    }
                } catch (error) {
                    this.log(`âŒ è¨ˆç®—ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    resultElement.textContent = 'ã‚¨ãƒ©ãƒ¼';
                }
            }

            clearCalculation() {
                document.getElementById('calc-number-a').value = '';
                document.getElementById('calc-number-b').value = '';
                document.getElementById('calc-result').textContent = '?';
                this.log('ğŸ—‘ï¸ è¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }

            async loadCalcHistory() {
                this.log('ğŸ“Š è¨ˆç®—å±¥æ­´ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                try {
                    const response = await fetch('/api/calc/history');
                    const result = await response.json();
                    
                    const container = document.getElementById('calc-history-list');
                    
                    if (!result.calculations || result.calculations.length === 0) {
                        container.innerHTML = '<div class="loading">è¨ˆç®—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                        return;
                    }
                    
                    let html = '';
                    
                    result.calculations.forEach(calc => {
                        const date = new Date(calc.timestamp).toLocaleString('ja-JP');
                        html += `
                            <div class="calc-history-item">
                                <div>
                                    <div class="calc-expression">${calc.numberA} + ${calc.numberB} = ${calc.result}</div>
                                    <div class="calc-timestamp">${date}</div>
                                </div>
                                <button class="calc-delete-btn" onclick="deleteCalcHistory('${calc.id}')">ğŸ—‘ï¸</button>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    this.log('ğŸ“Š è¨ˆç®—å±¥æ­´ã®èª­ã¿è¾¼ã¿å®Œäº†');
                    
                } catch (error) {
                    this.log(`âŒ è¨ˆç®—å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async deleteCalcHistory(calcId) {
                this.log(`ğŸ—‘ï¸ è¨ˆç®—å±¥æ­´å‰Šé™¤ | ID: ${calcId}`);
                
                try {
                    const response = await fetch(`/api/calc/history/${calcId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        this.loadCalcHistory();
                        this.log(`ğŸ—‘ï¸ è¨ˆç®—å±¥æ­´å‰Šé™¤å®Œäº† | ID: ${calcId}`);
                    } else {
                        this.log('âŒ è¨ˆç®—å±¥æ­´ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ è¨ˆç®—å±¥æ­´å‰Šé™¤ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            async exportCalcCSV() {
                this.log('ğŸ“¥ è¨ˆç®—å±¥æ­´CSVå‡ºåŠ›ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ');
                
                try {
                    const response = await fetch('/api/calc/export/csv', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `calc_history_${new Date().toISOString().slice(0, 10)}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                        window.URL.revokeObjectURL(url);
                        
                        this.log('ğŸ“¥ è¨ˆç®—å±¥æ­´CSVå‡ºåŠ›å®Œäº†');
                    } else {
                        this.log('âŒ è¨ˆç®—å±¥æ­´CSVå‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ è¨ˆç®—å±¥æ­´CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            // ================================================================
            // è¨­å®šç®¡ç†UIæ©Ÿèƒ½
            // ================================================================
            async loadConfigUI() {
                this.log('âš™ï¸ è¨­å®šUIã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                try {
                    const response = await fetch('/api/config');
                    const result = await response.json();
                    
                    // ã‚¢ãƒ—ãƒªæœ‰åŠ¹åŒ–ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
                    this.renderAppCheckboxes(result.config);
                    
                    // æ©Ÿèƒ½è¨­å®šãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
                    this.renderFeatureCheckboxes(result.config);
                    
                    this.log('âš™ï¸ è¨­å®šUIèª­ã¿è¾¼ã¿å®Œäº†');
                    
                } catch (error) {
                    this.log(`âŒ è¨­å®šUIèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            renderAppCheckboxes(config) {
                const container = document.getElementById('enabledAppsCheckboxes');
                const allApps = {
                    'money': { name: 'ãŠé‡‘ç®¡ç†', icon: 'ğŸ’°' },
                    'time': { name: 'æ™‚é–“ç®¡ç†', icon: 'â°' },
                    'weight': { name: 'ä½“é‡ç®¡ç†', icon: 'âš–ï¸' },
                    'memo': { name: 'ãƒ¡ãƒ¢ç®¡ç†', icon: 'ğŸ“' },
                    'calc': { name: 'è¨ˆç®—æ©Ÿ', icon: 'ğŸ§®' }
                };

                let html = '';
                Object.keys(allApps).forEach(appKey => {
                    const app = allApps[appKey];
                    const isEnabled = config.enabledApps && config.enabledApps.includes(appKey);
                    const checkedAttribute = isEnabled ? 'checked' : '';
                    const enabledClass = isEnabled ? 'enabled' : '';
                    
                    html += `
                        <div class="checkbox-item ${enabledClass}">
                            <input type="checkbox" id="app-${appKey}" ${checkedAttribute} onchange="toggleApp('${appKey}')">
                            <label for="app-${appKey}">
                                <span class="app-icon">${app.icon}</span>
                                ${app.name}
                            </label>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            renderFeatureCheckboxes(config) {
                const container = document.getElementById('featuresCheckboxes');
                const features = {
                    'firebaseAuth': { name: 'Firebaseèªè¨¼', icon: 'ğŸ”' },
                    'realtimeDatabase': { name: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ DB', icon: 'ğŸ”„' },
                    'csvExport': { name: 'CSVå‡ºåŠ›æ©Ÿèƒ½', icon: 'ğŸ“Š' },
                    'jsonLogs': { name: 'JSONãƒ­ã‚°', icon: 'ğŸ“' },
                    'debugMode': { name: 'ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰', icon: 'ğŸ›' }
                };

                let html = '';
                Object.keys(features).forEach(featureKey => {
                    const feature = features[featureKey];
                    const isEnabled = config.features && config.features[featureKey];
                    const checkedAttribute = isEnabled ? 'checked' : '';
                    const enabledClass = isEnabled ? 'enabled' : '';
                    
                    html += `
                        <div class="checkbox-item ${enabledClass}">
                            <input type="checkbox" id="feature-${featureKey}" ${checkedAttribute} onchange="toggleFeature('${featureKey}')">
                            <label for="feature-${featureKey}">
                                <span class="app-icon">${feature.icon}</span>
                                ${feature.name}
                            </label>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            async saveConfigUI() {
                this.log('ğŸ’¾ è¨­å®šä¿å­˜é–‹å§‹...');
                
                try {
                    // ç¾åœ¨ã®è¨­å®šã‚’å–å¾—
                    const response = await fetch('/api/config');
                    const currentConfig = await response.json();
                    
                    // ã‚¢ãƒ—ãƒªè¨­å®šã‚’æ›´æ–°
                    const enabledApps = [];
                    const appCheckboxes = document.querySelectorAll('#enabledAppsCheckboxes input[type="checkbox"]');
                    appCheckboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            const appName = checkbox.id.replace('app-', '');
                            enabledApps.push(appName);
                        }
                    });
                    
                    // æ©Ÿèƒ½è¨­å®šã‚’æ›´æ–°
                    const features = { ...currentConfig.config.features };
                    const featureCheckboxes = document.querySelectorAll('#featuresCheckboxes input[type="checkbox"]');
                    featureCheckboxes.forEach(checkbox => {
                        const featureName = checkbox.id.replace('feature-', '');
                        features[featureName] = checkbox.checked;
                    });
                    
                    // è¨­å®šã‚’ä¿å­˜
                    const updatedConfig = {
                        ...currentConfig.config,
                        enabledApps: enabledApps,
                        features: features
                    };
                    
                    const saveResponse = await fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedConfig)
                    });
                    
                    if (saveResponse.ok) {
                        this.log('ğŸ’¾ è¨­å®šä¿å­˜å®Œäº†');
                        alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚\\nå¤‰æ›´ã‚’é©ç”¨ã™ã‚‹ã«ã¯ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚');
                    } else {
                        this.log('âŒ è¨­å®šä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        alert('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                    }
                    
                } catch (error) {
                    this.log(`âŒ è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                    alert('è¨­å®šã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            }

            toggleApp(appName) {
                const checkbox = document.getElementById(`app-${appName}`);
                const container = checkbox.closest('.checkbox-item');
                
                if (checkbox.checked) {
                    container.classList.add('enabled');
                } else {
                    container.classList.remove('enabled');
                }
                
                this.log(`ğŸ“± ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆ | ${appName}: ${checkbox.checked ? 'ON' : 'OFF'}`);
            }

            toggleFeature(featureName) {
                const checkbox = document.getElementById(`feature-${featureName}`);
                const container = checkbox.closest('.checkbox-item');
                
                if (checkbox.checked) {
                    container.classList.add('enabled');
                } else {
                    container.classList.remove('enabled');
                }
                
                this.log(`âš™ï¸ æ©Ÿèƒ½åˆ‡ã‚Šæ›¿ãˆ | ${featureName}: ${checkbox.checked ? 'ON' : 'OFF'}`);
            }

            // ãƒ­ã‚°æ©Ÿèƒ½
            log(message) {
                const timestamp = new Date().toLocaleTimeString('ja-JP');
                const logEntry = `[${timestamp}] ${message}`;
                this.logs.push(logEntry);
                
                const debugLogs = document.getElementById('debugLogs');
                if (debugLogs) {
                    debugLogs.textContent = this.logs.slice(-50).join('\\n');
                    debugLogs.scrollTop = debugLogs.scrollHeight;
                }
                console.log(logEntry);
            }

            async downloadLogs() {
                try {
                    const response = await fetch('/api/generate-log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ source: 'smart-template-ui', logs: this.logs })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        this.log(`ğŸ“„ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆå®Œäº† | ${data.filename}`);
                    } else {
                        throw new Error(data.error || 'ãƒ­ã‚°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    this.log(`âŒ ãƒ­ã‚°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ | ${error.message}`);
                }
            }

            clearLogs() {
                this.logs = [];
                document.getElementById('debugLogs').textContent = 'ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ';
                this.log('ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }

            refreshLogs() {
                const debugLogs = document.getElementById('debugLogs');
                debugLogs.textContent = this.logs.slice(-50).join('\\n');
                debugLogs.scrollTop = debugLogs.scrollHeight;
                this.log('ğŸ”„ ãƒ­ã‚°è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        let app;
        
        window.addEventListener('load', () => {
            app = new SmartTemplateApp();
        });
        
        function testAPI() { app.testAPI(); }
        function downloadLogs() { app.downloadLogs(); }
        function clearLogs() { app.clearLogs(); }
        function refreshLogs() { app.refreshLogs(); }
        function generateSampleData() { app.generateSampleData(); }
        function loadConfig() { app.loadConfig(); }
        function saveConfig() { app.saveConfig(); }
        function addMoneyTransaction() { app.addMoneyTransaction(); }
        function exportMoneyCSV() { app.exportMoneyCSV(); }
        function copyLogsToClipboard() { app.copyLogsToClipboard(); }
        
        // æ™‚é–“ç®¡ç†é–¢æ•°
        function addTimeRecord() { app.addTimeRecord(); }
        function startTimer() { app.startTimer(); }
        function pauseTimer() { app.pauseTimer(); }
        function stopTimer() { app.stopTimer(); }
        function exportTimeCSV() { app.exportTimeCSV(); }
        
        // ä½“é‡ç®¡ç†é–¢æ•°
        function addWeightRecord() { app.addWeightRecord(); }
        function calculateBMI() { app.calculateBMI(); }
        function exportWeightCSV() { app.exportWeightCSV(); }
        
        // ãƒ¡ãƒ¢ç®¡ç†é–¢æ•°
        function addMemo() { app.addMemo(); }
        function deleteMemo(memoId) { app.deleteMemo(memoId); }
        function exportMemoCSV() { app.exportMemoCSV(); }
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°
        function addFilterKeyword() { app.addFilterKeyword(); }
        function clearAllFilters() { app.clearAllFilters(); }

        // è¨ˆç®—æ©Ÿç®¡ç†é–¢æ•°
        function calculateNumbers() { app.calculateNumbers(); }
        function clearCalculation() { app.clearCalculation(); }
        function deleteCalcHistory(calcId) { app.deleteCalcHistory(calcId); }
        function exportCalcCSV() { app.exportCalcCSV(); }

        // è¨­å®šç®¡ç†UIé–¢æ•°
        function loadConfigUI() { app.loadConfigUI(); }
        function saveConfigUI() { app.saveConfigUI(); }
        function toggleApp(appName) { app.toggleApp(appName); }
        function toggleFeature(featureName) { app.toggleFeature(featureName); }
        
        function resetConfig() { app.resetConfig(); }
        
        // ãƒ­ã‚°é–²è¦§æ©Ÿèƒ½
        let currentLogData = [];
        let allLogLines = [];
        let isAllLogsMode = false;
        
        function loadAllLogs() {
            isAllLogsMode = true;
            document.getElementById('logFileSelect').value = '';
            
            fetch('/api/logs/all')
                .then(response => response.json())
                .then(data => {
                    allLogLines = data.lines;
                    displayLogLines(allLogLines);
                    updateSearchCount(allLogLines.length);
                    
                    const display = document.getElementById('logDisplay');
                    display.scrollTop = 0; // å…ˆé ­ã«æˆ»ã‚‹
                    
                    console.log(`ğŸ“š å…¨ãƒ­ã‚°ä¸€æ‹¬è¡¨ç¤º: ${data.totalFiles}ãƒ•ã‚¡ã‚¤ãƒ«ã€${data.totalLines}è¡Œ`);
                })
                .catch(error => {
                    console.error('å…¨ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—:', error);
                    document.getElementById('logDisplay').textContent = 'å…¨ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    allLogLines = [];
                });
        }
        
        function loadLogFiles() {
            fetch('/api/logs/files')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('logFileSelect');
                    select.innerHTML = '<option value="">ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                    
                    data.files.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file.name;
                        option.textContent = `${file.name} (${formatFileSize(file.size)}) - ${formatDate(file.modified)}`;
                        select.appendChild(option);
                    });
                    
                    console.log(`ğŸ“‹ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§æ›´æ–°: ${data.files.length}ä»¶`);
                })
                .catch(error => {
                    console.error('ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®å–å¾—ã«å¤±æ•—:', error);
                    document.getElementById('logDisplay').textContent = 'ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
                });
        }
        
        function loadSelectedLog() {
            const select = document.getElementById('logFileSelect');
            const filename = select.value;
            
            isAllLogsMode = false;
            
            if (!filename) {
                document.getElementById('logDisplay').textContent = 'å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã‹ã€ã€Œå…¨ãƒ­ã‚°ä¸€æ‹¬è¡¨ç¤ºã€ã‚’ã”åˆ©ç”¨ãã ã•ã„';
                allLogLines = [];
                return;
            }
            
            fetch(`/api/logs/content/${filename}`)
                .then(response => response.json())
                .then(data => {
                    allLogLines = data.lines;
                    displayLogLines(allLogLines);
                    updateSearchCount(allLogLines.length);
                    console.log(`ğŸ“„ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿: ${filename} (${data.totalLines}è¡Œ)`);
                })
                .catch(error => {
                    console.error('ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                    document.getElementById('logDisplay').textContent = 'ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    allLogLines = [];
                });
        }
        
        function filterLogLines() {
            const searchInput = document.getElementById('logSearchInput');
            const keyword = searchInput.value.toLowerCase();
            
            if (!keyword) {
                displayLogLines(allLogLines);
                updateSearchCount(allLogLines.length);
                return;
            }
            
            const filteredLines = allLogLines.filter(line => 
                line.content.toLowerCase().includes(keyword)
            );
            
            displayLogLines(filteredLines, keyword);
            updateSearchCount(filteredLines.length);
        }
        
        function clearLogSearch() {
            document.getElementById('logSearchInput').value = '';
            displayLogLines(allLogLines);
            updateSearchCount(allLogLines.length);
        }
        
        function displayLogLines(lines, highlightKeyword = null) {
            const display = document.getElementById('logDisplay');
            
            if (lines.length === 0) {
                display.textContent = 'ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“';
                return;
            }
            
            const content = lines.map(line => {
                let content = line.content;
                let className = 'log-line';
                
                // å…¨ãƒ­ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç‰¹åˆ¥å‡¦ç†
                if (isAllLogsMode && line.isHeader) {
                    className += ' log-header';
                }
                
                if (highlightKeyword) {
                    const regex = new RegExp(`(${escapeRegex(highlightKeyword)})`, 'gi');
                    content = content.replace(regex, '<mark>$1</mark>');
                }
                
                // è¡Œç•ªå·ã«ãƒ•ã‚¡ã‚¤ãƒ«åãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ï¼ˆå…¨ãƒ­ã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ï¼‰
                let linePrefix = line.lineNumber.toString().padStart(4, ' ');
                if (isAllLogsMode && line.fileName && !line.isHeader) {
                    const filePrefix = line.fileName.substring(0, 4); // ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ€åˆ4æ–‡å­—
                    linePrefix = `${filePrefix}:${line.lineNumber.toString().padStart(3, ' ')}`;
                }
                
                return `<div class="${className}">${linePrefix}: ${content}</div>`;
            }).join('');
            
            display.innerHTML = content;
        }
        
        function updateSearchCount(count) {
            document.getElementById('searchResultCount').textContent = `${count}ä»¶`;
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ja-JP');
        }
        
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†ã§ã€ãƒ­ã‚°ã‚¿ãƒ–ãŒé¸æŠã•ã‚ŒãŸæ™‚ã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
            const originalShowAppContent = window.showAppContent || function() {};
            window.showAppContent = function(appName) {
                originalShowAppContent(appName);
                if (appName === 'logs' && document.getElementById('logFileSelect').children.length <= 1) {
                    loadLogFiles();
                }
            };
        });
    </script>
</body>
</html>